<!DOCTYPE html>
<html>
<head>
  <title>User</title>
</head>
<body>

<script src="/guard.js"></script>

<h2>Public Profile</h2>

<div id="profile"></div>

<h3>Posts</h3>
<div id="posts"></div>

<br>
<a href="/feed.html">Back</a>

<script>
const API = "https://axiom-backend-v1.onrender.com";

const params = new URLSearchParams(location.search);
const id = params.get("id");

fetch(API + "/api/users/" + id, {
  headers: {
    Authorization: "Bearer " + localStorage.getItem("token")
  }
})
.then(r => r.json())
.then(d => {

  // profile
  const p = d.profile;

  document.getElementById("profile").innerHTML = `
    <p><b>Name:</b> ${p.name}</p>
    <p><b>Bio:</b> ${p.bio || "-"}</p>
  `;

  // posts
  const container = document.getElementById("posts");

  if (!d.posts.length) {
    container.innerHTML = "No posts yet";
    return;
  }

  d.posts.forEach(post => {
    const div = document.createElement("div");
    div.innerHTML = `
      <p>${post.content}</p>
      <small>${new Date(post.createdAt).toLocaleString()}</small>
      <hr>
    `;
    container.appendChild(div);
  });

});
</script>

</body>
</html>
