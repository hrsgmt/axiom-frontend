<button id="logout">Logout</button>
<pre id="profile"></pre>
<!DOCTYPE html>
<html>
<head>
  <title>Profile</title>
</head>
<body><script src="/js/guard.js"></script>
  <h1>Profile</h1>
  <pre id="output">Loading...</pre>
  <button onclick="logout()">Logout</button>

  <script type="module">
    import { requireAuth, logout } from "./js/auth.js";
    import { apiGet } from "./js/api.js";

    const token = requireAuth();
    if (!token) throw new Error("Not authenticated");

    apiGet("/api/me")
      .then(data => {
        document.getElementById("output").textContent =
          JSON.stringify(data, null, 2);
      })
      .catch(() => {
        logout();
      });

    window.logout = logout;
  </script>
<script src="/js/logout.js"></script><button onclick="logout()">Logout</button><script src="/js/logout.js"></script></body>
</html>
